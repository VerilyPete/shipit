{{ define "main" }}
<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">{{ .Title }}</h1>
    {{- if .Description }}
    <div class="post-description">{{ .Description }}</div>
    {{- end }}
  </header>

  <div class="post-content">
    {{ .Content }}

    <div class="contact-form-container">
      <!-- Hugo sees basinEndpoint as: [{{ .Site.Params.basinEndpoint }}] -->
      <form action="{{ .Site.Params.basinEndpoint }}" method="POST" class="contact-form" data-ajax="true">
        <div class="form-group">
          <label for="name">Name *</label>
          <input type="text" id="name" name="name" required placeholder="Your name">
        </div>

        <div class="form-group">
          <label for="email">Email *</label>
          <input type="email" id="email" name="email" required placeholder="your.email@example.com">
        </div>

        <div class="form-group">
          <label for="subject">Subject *</label>
          <input type="text" id="subject" name="subject" required placeholder="What's this about?">
        </div>

        <div class="form-group">
          <label for="message">Message *</label>
          <textarea id="message" name="message" rows="6" required placeholder="Tell me more..."></textarea>
        </div>

        <!-- Honeypot field for spam prevention -->
        <input type="text" name="website" tabindex="-1" autocomplete="off" style="display:none">

        <div class="form-status" data-status></div>

        <button type="submit" class="submit-button">Send Message</button>
      </form>
    </div>
  </div>

  <script>
    function wireContactForm(form) {
      if (!form) return;
      form.addEventListener('submit', async (e) => {
        if (!form.dataset.ajax) return;
        e.preventDefault();
        const btn = form.querySelector('[type="submit"]');
        const status = form.querySelector('[data-status]');
        btn.disabled = true;
        status.textContent = 'Sendingâ€¦';
        try {
          const res = await fetch(form.action, { method: 'POST', body: new FormData(form), headers: { 'Accept': 'application/json' }});
          if (res.ok) { status.textContent = 'Thanks! Your message was sent.'; form.reset(); }
          else { status.textContent = 'Sorry, something went wrong. Please try again.'; }
        } catch (_) { status.textContent = 'Network error. Please try again.'; }
        btn.disabled = false;
      });
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.contact-form').forEach(wireContactForm);
    });
  </script>
</article>
{{ end }}

